<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CrimeScope</title>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/mapbox-gl@2.15.0/dist/mapbox-gl.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mapbox-gl@2.15.0/dist/mapbox-gl.css">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@mapbox/mapbox-gl-geocoder@5.0.0/dist/mapbox-gl-geocoder.min.js"></script>
    <link href="https://unpkg.com/@mapbox/mapbox-gl-geocoder@5.0.0/dist/mapbox-gl-geocoder.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#212121',
                        secondary: '#3498db',
                        accent: '#e74c3c',
                        background: '#2c3e50',
                        text: '#ffffff'
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: #2c3e50;
            color: #ffffff;
        }

        .mapboxgl-ctrl-geocoder {
            width: 100% !important;
            max-width: 100% !important;
            border-radius: 0.375rem;
            background-color: #2c3e50;
            color: #ffffff;
        }

        .mapboxgl-ctrl-geocoder--input {
            color: #ffffff !important;
            background-color: #374151 !important;
        }

        .mapboxgl-ctrl-geocoder--icon {
            fill: #ffffff !important;
        }

        .pulsing-circle {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: rgba(231, 76, 60, 0.6);
            animation: pulse 2s infinite;
            position: absolute;
            transform: translate(-50%, -50%);
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            50% { transform: translate(-50%, -50%) scale(1.5); opacity: 0.5; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .crime-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 1rem;
        }

        .mapboxgl-popup-content {
            background-color: #212121;
            color: #ffffff;
            border-radius: 0.5rem;
            padding: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .mapboxgl-popup-close-button {
            color: #ffffff;
        }

        /* Loading animation */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #e74c3c;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #374151;
        }

        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
    </style>
</head>
<body class="min-h-screen" x-data="app()">
    <!-- Loading Overlay -->
    <div x-show="isLoading" class="fixed inset-0 bg-background bg-opacity-80 flex items-center justify-center z-50">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-lg" x-text="loadingMessage">Loading...</p>
        </div>
    </div>

    <!-- Navigation -->
    <nav x-show="isLoggedIn" class="fixed bottom-0 w-full bg-primary text-white z-40">
        <div class="flex justify-around items-center p-4">
            <button @click="currentScreen = 'home'" :class="currentScreen === 'home' ? 'text-accent' : ''">
                <i class="bi bi-house-door text-2xl"></i>
            </button>
            <button @click="currentScreen = 'search'" :class="currentScreen === 'search' ? 'text-accent' : ''">
                <i class="bi bi-search text-2xl"></i>
            </button>
            <button @click="currentScreen = 'dashboard'" :class="currentScreen === 'dashboard' ? 'text-accent' : ''">
                <i class="bi bi-graph-up text-2xl"></i>
            </button>
            <button @click="currentScreen = 'profile'" :class="currentScreen === 'profile' ? 'text-accent' : ''">
                <i class="bi bi-person text-2xl"></i>
            </button>
        </div>
    </nav>

    <!-- Login Screen -->
    <div x-show="!isLoggedIn" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md space-y-8">
            <div class="text-center">
                <h1 class="text-4xl font-bold mb-2">CrimeScope</h1>
                <p class="text-gray-300 text-lg">Stay Safe, Stay Informed</p>
            </div>
            <form @submit.prevent="login" class="space-y-4">
                <div>
                    <label for="email" class="sr-only">Email</label>
                    <div class="relative">
                        <input 
                            type="email" 
                            id="email"
                            x-model="loginForm.email" 
                            placeholder="Email" 
                            class="w-full p-3 rounded bg-gray-700 text-white border border-gray-600 focus:border-secondary focus:outline-none"
                            required
                        >
                        <button 
                            type="button" 
                            @click="loginForm.email = ''" 
                            x-show="loginForm.email" 
                            class="absolute right-3 top-3 text-gray-400 hover:text-white"
                        >
                            <i class="bi bi-x"></i>
                        </button>
                    </div>
                </div>
                <div>
                    <label for="password" class="sr-only">Password</label>
                    <div class="relative">
                        <input 
                            :type="showPassword ? 'text' : 'password'" 
                            id="password"
                            x-model="loginForm.password" 
                            placeholder="Password" 
                            class="w-full p-3 rounded bg-gray-700 text-white border border-gray-600 focus:border-secondary focus:outline-none"
                            required
                        >
                        <button 
                            type="button" 
                            @click="showPassword = !showPassword" 
                            class="absolute right-3 top-3 text-gray-400 hover:text-white"
                        >
                            <i :class="showPassword ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
                        </button>
                    </div>
                </div>
                <button 
                    type="submit" 
                    class="w-full p-3 rounded bg-accent text-white font-semibold hover:bg-opacity-90 transition"
                >
                    Login
                </button>
            </form>
            <div class="text-center">
                <p class="text-gray-400">Or continue with</p>
                <div class="flex justify-center gap-4 mt-4">
                    <button class="p-3 rounded bg-gray-700 hover:bg-gray-600 transition">
                        <i class="bi bi-google"></i>
                    </button>
                    <button class="p-3 rounded bg-gray-700 hover:bg-gray-600 transition">
                        <i class="bi bi-facebook"></i>
                    </button>
                </div>
            </div>
            <p class="text-center">
                Don't have an account? 
                <button @click="showSignup = true" class="text-secondary hover:underline">
                    Sign up <i class="bi bi-arrow-right"></i>
                </button>
            </p>
        </div>
    </div>

    <!-- Signup Screen -->
    <div x-show="showSignup && !isLoggedIn" class="fixed inset-0 bg-background bg-opacity-90 flex items-center justify-center p-4 z-50">
        <div class="w-full max-w-md space-y-6 bg-primary p-6 rounded-lg shadow-lg">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold">Create Account</h2>
                <button @click="showSignup = false" class="text-gray-400 hover:text-white">
                    <i class="bi bi-x text-2xl"></i>
                </button>
            </div>
            <form @submit.prevent="register" class="space-y-4">
                <div>
                    <input 
                        type="text" 
                        x-model="signupForm.name" 
                        placeholder="Full Name" 
                        class="w-full p-3 rounded bg-gray-700 text-white border border-gray-600 focus:border-secondary focus:outline-none"
                        required
                    >
                </div>
                <div>
                    <input 
                        type="email" 
                        x-model="signupForm.email" 
                        placeholder="Email" 
                        class="w-full p-3 rounded bg-gray-700 text-white border border-gray-600 focus:border-secondary focus:outline-none"
                        required
                    >
                </div>
                <div class="relative">
                    <input 
                        :type="showSignupPassword ? 'text' : 'password'" 
                        x-model="signupForm.password" 
                        placeholder="Password" 
                        class="w-full p-3 rounded bg-gray-700 text-white border border-gray-600 focus:border-secondary focus:outline-none"
                        required
                    >
                    <button 
                        type="button" 
                        @click="showSignupPassword = !showSignupPassword" 
                        class="absolute right-3 top-3 text-gray-400 hover:text-white"
                    >
                        <i :class="showSignupPassword ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
                    </button>
                </div>
                <div>
                    <select 
                        x-model="signupForm.role" 
                        class="w-full p-3 rounded bg-gray-700 text-white border border-gray-600 focus:border-secondary focus:outline-none"
                        required
                    >
                        <option value="" disabled selected>Select Role</option>
                        <option value="citizen">Citizen</option>
                        <option value="police">Police Officer</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <button 
                    type="submit" 
                    class="w-full p-3 rounded bg-accent text-white font-semibold hover:bg-opacity-90 transition"
                >
                    Sign Up
                </button>
            </form>
            <p class="text-center">
                Already have an account? 
                <button @click="showSignup = false" class="text-secondary hover:underline">
                    Login <i class="bi bi-arrow-right"></i>
                </button>
            </p>
        </div>
    </div>

    <!-- Main App Content -->
    <div x-show="isLoggedIn" class="pb-20">
        <!-- Home Screen / Crime Map -->
        <template x-if="currentScreen === 'home'">
            <div class="h-screen relative">
                <div id="map" class="h-full w-full"></div>
                
                <!-- Map Controls -->
                <div class="absolute top-4 right-4 flex flex-col space-y-2">
                    <button 
                        @click="togglePredictions" 
                        class="p-2 rounded bg-primary text-white flex items-center"
                        :class="showPredictions ? 'bg-accent' : 'bg-primary'"
                    >
                        <i class="bi bi-lightning-charge mr-2"></i>
                        <span>Predictions</span>
                    </button>
                </div>
                
                <!-- Bottom Filter Panel -->
                <div class="absolute bottom-20 left-0 right-0 bg-primary p-4 space-y-4 shadow-lg">
                    <div class="flex items-center justify-between">
                        <h3 class="font-semibold">Filter Reports</h3>
                        <button @click="toggleFilterPanel" class="text-gray-400 hover:text-white">
                            <i class="bi bi-chevron-down"></i>
                        </button>
                    </div>
                    
                    <div x-show="showFilterPanel" class="space-y-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Crime Type</label>
                            <select 
                                x-model="filters.crimeType" 
                                @change="applyFilters"
                                class="w-full p-2 rounded bg-gray-700 text-white"
                            >
                                <option value="all">All Crime Types</option>
                                <option value="theft">Theft</option>
                                <option value="assault">Assault</option>
                                <option value="vandalism">Vandalism</option>
                                <option value="burglary">Burglary</option>
                                <option value="robbery">Robbery</option>
                                <option value="homicide">Homicide</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Date Range</label>
                            <div class="flex space-x-2">
                                <input 
                                    type="date" 
                                    x-model="filters.startDate" 
                                    @change="applyFilters"
                                    class="flex-1 p-2 rounded bg-gray-700 text-white"
                                >
                                <input 
                                    type="date" 
                                    x-model="filters.endDate" 
                                    @change="applyFilters"
                                    class="flex-1 p-2 rounded bg-gray-700 text-white"
                                >
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">
                                Severity: <span x-text="filters.severity"></span>
                            </label>
                            <input 
                                type="range" 
                                min="1" 
                                max="5" 
                                x-model.number="filters.severity" 
                                @input="applyFilters"
                                class="w-full"
                            >
                        </div>
                    </div>
                </div>
                
                <!-- Smart Route Button -->
                <button 
                    @click="showSmartRouteModal = true"
                    class="absolute bottom-24 left-4 p-3 rounded bg-secondary text-white shadow-lg flex items-center"
                >
                    <i class="bi bi-compass mr-2"></i> Smart Route
                </button>
                
                <!-- FAB for Reporting Crime -->
                <button 
                    @click="showReportCrime = true" 
                    class="absolute bottom-24 right-4 p-4 rounded-full bg-accent text-white shadow-lg"
                >
                    <i class="bi bi-plus text-2xl"></i>
                </button>
                
                <!-- Notifications Indicator -->
                <div class="absolute top-4 left-4 flex flex-col space-y-2">
                    <button 
                        @click="showNotifications = true" 
                        class="p-2 rounded bg-primary text-white relative"
                    >
                        <i class="bi bi-bell text-xl"></i>
                        <span 
                            x-show="notifications.length > 0"
                            class="absolute -top-1 -right-1 bg-accent text-xs text-white rounded-full w-5 h-5 flex items-center justify-center"
                            x-text="notifications.length"
                        ></span>
                    </button>
                </div>
            </div>
        </template>
        
        <!-- Smart Route Modal -->
        <div 
            x-show="showSmartRouteModal" 
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
        >
            <div class="bg-primary rounded-lg w-full max-w-lg p-6 space-y-4 shadow-lg">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold">Smart Route Planner</h2>
                    <button @click="showSmartRouteModal = false" class="text-gray-400 hover:text-white">
                        <i class="bi bi-x text-2xl"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Start Location</label>
                        <div id="start-location-input" class="w-full"></div>
                    </div>
                    
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Destination</label>
                        <div id="destination-input" class="w-full"></div>
                    </div>
                    
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Safety Priority</label>
                        <div class="flex items-center justify-between text-xs text-gray-400">
                            <span>Faster</span>
                            <span>Safer</span>
                        </div>
                        <input 
                            type="range" 
                            min="1" 
                            max="10" 
                            x-model.number="smartRouteSettings.safetyPriority" 
                            class="w-full"
                        >
                    </div>
                    
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Transportation Mode</label>
                        <div class="grid grid-cols-3 gap-2 mt-1">
                            <button 
                                @click="smartRouteSettings.mode = 'walking'" 
                                class="p-2 rounded flex flex-col items-center justify-center"
                                :class="smartRouteSettings.mode === 'walking' ? 'bg-secondary text-white' : 'bg-gray-700 text-gray-300'"
                            >
                                <i class="bi bi-person-walking text-xl"></i>
                                <span class="text-sm mt-1">Walking</span>
                            </button>
                            <button 
                                @click="smartRouteSettings.mode = 'driving'" 
                                class="p-2 rounded flex flex-col items-center justify-center"
                                :class="smartRouteSettings.mode === 'driving' ? 'bg-secondary text-white' : 'bg-gray-700 text-gray-300'"
                            >
                                <i class="bi bi-car-front text-xl"></i>
                                <span class="text-sm mt-1">Driving</span>
                            </button>
                            <button 
                                @click="smartRouteSettings.mode = 'transit'" 
                                class="p-2 rounded flex flex-col items-center justify-center"
                                :class="smartRouteSettings.mode === 'transit' ? 'bg-secondary text-white' : 'bg-gray-700 text-gray-300'"
                            >
                                <i class="bi bi-bus-front text-xl"></i>
                                <span class="text-sm mt-1">Transit</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <button 
                    @click="calculateSmartRoute" 
                    class="w-full p-3 rounded bg-accent text-white font-semibold hover:bg-opacity-90 transition"
                >
                    Calculate Safe Route
                </button>
            </div>
        </div>

        <!-- Report Crime Modal -->
        <div 
            x-show="showReportCrime" 
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
        >
            <div class="bg-primary rounded-lg w-full max-w-lg p-6 space-y-4 shadow-lg max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold">Report Crime</h2>
                    <button @click="showReportCrime = false" class="text-gray-400 hover:text-white">
                        <i class="bi bi-x text-2xl"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Crime Type</label>
                        <div class="crime-type-grid">
                            <button 
                                @click="crimeReport.type = 'theft'"
                                class="p-3 rounded flex flex-col items-center justify-center"
                                :class="crimeReport.type === 'theft' ? 'bg-accent text-white' : 'bg-gray-700 text-gray-300'"
                            >
                                <i class="bi bi-wallet2 text-2xl"></i>
                                <p class="mt-2 text-sm">Theft</p>
                            </button>
                            <button 
                                @click="crimeReport.type = 'assault'"
                                class="p-3 rounded flex flex-col items-center justify-center"
                                :class="crimeReport.type === 'assault' ? 'bg-accent text-white' : 'bg-gray-700 text-gray-300'"
                            >
                                <i class="bi bi-exclamation-triangle text-2xl"></i>
                                <p class="mt-2 text-sm">Assault</p>
                            </button>
                            <button 
                                @click="crimeReport.type = 'vandalism'"
                                class="p-3 rounded flex flex-col items-center justify-center"
                                :class="crimeReport.type === 'vandalism' ? 'bg-accent text-white' : 'bg-gray-700 text-gray-300'"
                            >
                                <i class="bi bi-hammer text-2xl"></i>
                                <p class="mt-2 text-sm">Vandalism</p>
                            </button>
                            <button 
                                @click="crimeReport.type = 'burglary'"
                                class="p-3 rounded flex flex-col items-center justify-center"
                                :class="crimeReport.type === 'burglary' ? 'bg-accent text-white' : 'bg-gray-700 text-gray-300'"
                            >
                                <i class="bi bi-house-lock text-2xl"></i>
                                <p class="mt-2 text-sm">Burglary</p>
                            </button>
                            <button 
                                @click="crimeReport.type = 'robbery'"
                                class="p-3 rounded flex flex-col items-center justify-center"
                                :class="crimeReport.type === 'robbery' ? 'bg-accent text-white' : 'bg-gray-700 text-gray-300'"
                            >
                                <i class="bi bi-mask text-2xl"></i>
                                <p class="mt-2 text-sm">Robbery</p>
                            </button>
                            <button 
                                @click="crimeReport.type = 'homicide'"
                                class="p-3 rounded flex flex-col items-center justify-center"
                                :class="crimeReport.type === 'homicide' ? 'bg-accent text-white' : 'bg-gray-700 text-gray-300'"
                            >
                                <i class="bi bi-heartbreak text-2xl"></i>
                                <p class="mt-2 text-sm">Homicide</p>
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Date & Time</label>
                        <input 
                            type="datetime-local" 
                            x-model="crimeReport.datetime" 
                            class="w-full p-3 rounded bg-gray-700 text-white"
                        >
                    </div>
                    
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Location</label>
                        <div id="report-location-input" class="w-full"></div>
                    </div>
                    
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Description</label>
                        <textarea 
                            x-model="crimeReport.description" 
                            placeholder="Describe what happened..." 
                            class="w-full p-3 rounded bg-gray-700 text-white h-32 resize-none"
                        ></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Media Evidence</label>
                        <div class="flex gap-4">
                            <button 
                                @click="capturePhoto" 
                                class="flex-1 p-3 rounded bg-gray-700 hover:bg-gray-600 transition flex items-center justify-center"
                            >
                                <i class="bi bi-camera mr-2"></i> Camera
                            </button>
                            <button 
                                @click="uploadFromGallery" 
                                class="flex-1 p-3 rounded bg-gray-700 hover:bg-gray-600 transition flex items-center justify-center"
                            >
                                <i class="bi bi-image mr-2"></i> Gallery
                            </button>
                        </div>
                        <input type="file" id="fileInput" class="hidden" accept="image/*" @change="handleFileUpload">
                    </div>
                    
                    <div x-show="crimeReport.media.length > 0" class="mt-2">
                        <label class="block text-sm text-gray-400 mb-1">Uploaded Files</label>
                        <div class="flex flex-wrap gap-2">
                            <template x-for="(file, index) in crimeReport.media" :key="index">
                                <div class="relative">
                                    <img :src="file.url" class="w-20 h-20 object-cover rounded">
                                    <button 
                                        @click="removeMedia(index)" 
                                        class="absolute -top-2 -right-2 bg-accent rounded-full w-6 h-6 flex items-center justify-center"
                                    >
                                        <i class="bi bi-x"></i>
                                    </button>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                
                <button 
                    @click="submitCrimeReport" 
                    class="w-full p-3 rounded bg-accent text-white font-semibold hover:bg-opacity-90 transition"
                >
                    Submit Report
                </button>
            </div>
        </div>

        <!-- Notifications Panel -->
        <div 
            x-show="showNotifications" 
            class="fixed inset-x-0 bottom-20 bg-primary p-4 z-40 shadow-lg max-h-[70vh] overflow-y-auto"
            @click.outside="showNotifications = false"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="transform translate-y-full"
            x-transition:enter-end="transform translate-y-0"
            x-transition:leave="transition ease-in duration-300"
            x-transition:leave-start="transform translate-y-0"
            x-transition:leave-end="transform translate-y-full"
        >
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Notifications</h3>
                <button @click="showNotifications = false" class="text-gray-400 hover:text-white">
                    <i class="bi bi-x text-2xl"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <template x-if="notifications.length === 0">
                    <div class="text-center py-4 text-gray-400">
                        <i class="bi bi-bell-slash text-3xl mb-2"></i>
                        <p>No new notifications</p>
                    </div>
                </template>
                
                <template x-for="(notification, index) in notifications" :key="index">
                    <div 
                        class="p-3 rounded bg-gray-700 flex items-center space-x-3"
                        :class="notification.read ? 'opacity-70' : ''"
                    >
                        <div class="flex-shrink-0">
                            <i 
                                class="text-2xl"
                                :class="{
                                    'bi bi-exclamation-circle text-accent': notification.type === 'alert',
                                    'bi bi-geo-alt text-secondary': notification.type === 'proximity',
                                    'bi bi-info-circle text-gray-300': notification.type === 'info'
                                }"
                            ></i>
                        </div>
                        <div class="flex-grow">
                            <p class="font-medium" x-text="notification.message"></p>
                            <p class="text-sm text-gray-400" x-text="notification.time"></p>
                        </div>
                        <div class="flex-shrink-0">
                            <button @click="markNotificationAsRead(index)" x-show="!notification.read" class="text-gray-400 hover:text-white">
                                <i class="bi bi-check2"></i>
                            </button>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Search Screen -->
        <template x-if="currentScreen === 'search'">
            <div class="min-h-screen p-4 pb-24 space-y-6">
                <h1 class="text-2xl font-bold">Criminal Record Search</h1>
                
                <div class="sticky top-0 z-30 bg-background pt-4 pb-2">
                    <div class="relative">
                        <input 
                            type="text" 
                            x-model="searchQuery" 
                            @input="performSearch"
                            placeholder="Search by name or ID" 
                            class="w-full p-3 pl-10 rounded bg-gray-700 text-white"
                        >
                        <i class="bi bi-search absolute left-3 top-3 text-gray-400"></i>
                        <div class="absolute right-0 top-0 flex items-center h-full">
                            <button 
                                x-show="searchQuery" 
                                @click="clearSearch" 
                                class="p-3 text-gray-400 hover:text-white"
                            >
                                <i class="bi bi-x"></i>
                            </button>
                            <button @click="showFaceSearchModal = true" class="p-3 text-gray-400 hover:text-white">
                                <i class="bi bi-camera"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex mt-4 border-b border-gray-700">
                        <button 
                            @click="searchTab = 'name'" 
                            class="pb-2 px-4 font-medium"
                            :class="searchTab === 'name' ? 'text-accent border-b-2 border-accent' : 'text-gray-400'"
                        >
                            By Name/ID
                        </button>
                        <button 
                            @click="searchTab = 'face'" 
                            class="pb-2 px-4 font-medium"
                            :class="searchTab === 'face' ? 'text-accent border-b-2 border-accent' : 'text-gray-400'"
                        >
                            By Face
                        </button>
                    </div>
                </div>
                
                <!-- Search Results -->
                <div class="space-y-4">
                    <template x-if="searchTab === 'name' && isSearching">
                        <div class="text-center py-8">
                            <div class="loading-spinner mx-auto mb-4"></div>
                            <p>Searching records...</p>
                        </div>
                    </template>
                    
                    <template x-if="searchTab === 'name' && !isSearching && searchResults.length === 0 && searchQuery">
                        <div class="text-center py-8 text-gray-400">
                            <i class="bi bi-search text-4xl mb-2"></i>
                            <p>No records found matching "<span x-text="searchQuery"></span>"</p>
                        </div>
                    </template>
                    
                    <template x-if="searchTab === 'name' && !isSearching && searchResults.length > 0">
                        <div class="space-y-4">
                            <p class="text-gray-400"><span x-text="searchResults.length"></span> results found</p>
                            
                            <template x-for="(criminal, index) in searchResults" :key="index">
                                <div 
                                    @click="viewCriminalProfile(criminal.id)" 
                                    class="p-4 rounded bg-gray-700 flex items-center space-x-4 cursor-pointer hover:bg-gray-600 transition"
                                >
                                    <div class="w-12 h-12 rounded-full bg-gray-500 overflow-hidden flex-shrink-0">
                                        <img 
                                            :src="criminal.avatar || 'https://source.unsplash.com/random/100x100/?silhouette'" 
                                            class="w-full h-full object-cover"
                                            alt="Profile avatar"
                                        >
                                    </div>
                                    <div class="flex-grow">
                                        <h3 class="font-medium" x-text="criminal.name"></h3>
                                        <p class="text-sm text-gray-400" x-text="criminal.summary"></p>
                                    </div>
                                    <div class="flex-shrink-0">
                                        <i class="bi bi-chevron-right text-gray-400"></i>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>
                    
                    <template x-if="searchTab === 'face'">
                        <div class="text-center py-8">
                            <template x-if="faceSearchImage">
                                <div class="mb-4">
                                    <img :src="faceSearchImage" class="mx-auto max-h-64 rounded shadow">
                                    <button 
                                        @click="clearFaceSearch" 
                                        class="mt-2 p-2 text-accent hover:underline inline-flex items-center"
                                    >
                                        <i class="bi bi-trash mr-1"></i> Clear image
                                    </button>
                                </div>
                            </template>
                            
                            <template x-if="!faceSearchImage">
                                <div class="space-y-4">
                                    <i class="bi bi-camera text-5xl text-gray-400"></i>
                                    <p class="text-gray-400">Use the camera button above to<br>search by facial recognition</p>
                                    <button 
                                        @click="showFaceSearchModal = true" 
                                        class="px-4 py-2 rounded bg-secondary text-white font-medium"
                                    >
                                        Upload Face Image
                                    </button>
                                </div>
                            </template>
                            
                            <template x-if="faceSearchImage && faceSearchResults.length > 0">
                                <div class="mt-8 space-y-4">
                                    <h3 class="font-medium text-left">Potential Matches</h3>
                                    
                                    <template x-for="(result, index) in faceSearchResults" :key="index">
                                        <div 
                                            @click="viewCriminalProfile(result.id)" 
                                            class="p-4 rounded bg-gray-700 flex items-center space-x-4 cursor-pointer hover:bg-gray-600 transition"
                                        >
                                            <div class="w-12 h-12 rounded-full bg-gray-500 overflow-hidden flex-shrink-0">
                                                <img 
                                                    :src="result.avatar" 
                                                    class="w-full h-full object-cover"
                                                    alt="Profile avatar"
                                                >
                                            </div>
                                            <div class="flex-grow">
                                                <h3 class="font-medium" x-text="result.name"></h3>
                                                <div class="flex items-center mt-1">
                                                    <div class="w-full bg-gray-600 rounded-full h-2">
                                                        <div 
                                                            class="bg-accent h-2 rounded-full" 
                                                            :style="`width: ${result.matchPercentage}%`"
                                                        ></div>
                                                    </div>
                                                    <span class="ml-2 text-sm" x-text="`${result.matchPercentage}%`"></span>
                                                </div>
                                            </div>
                                            <div class="flex-shrink-0">
                                                <i class="bi bi-chevron-right text-gray-400"></i>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </template>
                </div>
            </div>
        </template>
        
        <!-- Face Search Modal -->
        <div 
            x-show="showFaceSearchModal" 
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
        >
            <div class="bg-primary rounded-lg w-full max-w-lg p-6 space-y-4">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold">Face Search</h2>
                    <button @click="showFaceSearchModal = false" class="text-gray-400 hover:text-white">
                        <i class="bi bi-x text-2xl"></i>
                    </button>
                </div>
                
                <div class="space-y-6">
                    <div class="flex gap-4">
                        <button 
                            @click="captureFacePhoto" 
                            class="flex-1 p-3 rounded bg-gray-700 hover:bg-gray-600 transition flex items-center justify-center"
                        >
                            <i class="bi bi-camera mr-2"></i> Camera
                        </button>
                        <button 
                            @click="uploadFaceFromGallery" 
                            class="flex-1 p-3 rounded bg-gray-700 hover:bg-gray-600 transition flex items-center justify-center"
                        >
                            <i class="bi bi-image mr-2"></i> Gallery
                        </button>
                    </div>
                    <input type="file" id="faceFileInput" class="hidden" accept="image/*" @change="handleFaceFileUpload">
                    
                    <div x-show="tempFaceImage" class="text-center">
                        <img :src="tempFaceImage" class="mx-auto max-h-64 rounded">
                    </div>
                </div>
                
                <div class="flex gap-4">
                    <button 
                        @click="showFaceSearchModal = false" 
                        class="flex-1 p-3 rounded bg-gray-700 text-white"
                    >
                        Cancel
                    </button>
                    <button 
                        @click="confirmFaceSearch" 
                        class="flex-1 p-3 rounded bg-accent text-white font-semibold"
                        :disabled="!tempFaceImage"
                        :class="!tempFaceImage ? 'opacity-50 cursor-not-allowed' : ''"
                    >
                        Search
                    </button>
                </div>
            </div>
        </div>

        <!-- Criminal Profile Modal -->
        <div 
            x-show="showCriminalProfile" 
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-0 z-50"
        >
            <div class="bg-primary rounded-lg w-full max-w-lg max-h-screen overflow-y-auto">
                <div class="sticky top-0 z-10 bg-primary flex justify-between items-center p-4 border-b border-gray-700">
                    <h2 class="text-xl font-bold">Criminal Profile</h2>
                    <button @click="showCriminalProfile = false" class="text-gray-400 hover:text-white">
                        <i class="bi bi-x text-2xl"></i>
                    </button>
                </div>
                
                <div class="p-4 space-y-6">
                    <!-- Profile Header -->
                    <div class="flex items-center space-x-4">
                        <div class="w-20 h-20 rounded-full bg-gray-500 overflow-hidden flex-shrink-0">
                            <img 
                                :src="currentCriminal.avatar || 'https://source.unsplash.com/random/100x100/?silhouette'" 
                                class="w-full h-full object-cover"
                                alt="Criminal profile"
                            >
                        </div>
                        <div>
                            <h3 class="text-xl font-bold" x-text="currentCriminal.name"></h3>
                            <div class="flex items-center mt-1">
                                <span 
                                    class="px-2 py-1 text-xs rounded-full mr-2"
                                    :class="currentCriminal.status === 'Active' ? 'bg-accent text-white' : 'bg-green-600 text-white'"
                                    x-text="currentCriminal.status"
                                ></span>
                                <span class="text-gray-400 text-sm" x-text="currentCriminal.lastSeen"></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Profile Tabs -->
                    <div class="border-b border-gray-700">
                        <div class="flex">
                            <button 
                                @click="profileTab = 'history'" 
                                class="pb-2 px-4 font-medium"
                                :class="profileTab === 'history' ? 'text-accent border-b-2 border-accent' : 'text-gray-400'"
                            >
                                Offense History
                            </button>
                            <button 
                                @click="profileTab = 'timeline'" 
                                class="pb-2 px-4 font-medium"
                                :class="profileTab === 'timeline' ? 'text-accent border-b-2 border-accent' : 'text-gray-400'"
                            >
                                Map Timeline
                            </button>
                            <button 
                                @click="profileTab = 'connections'" 
                                class="pb-2 px-4 font-medium"
                                :class="profileTab === 'connections' ? 'text-accent border-b-2 border-accent' : 'text-gray-400'"
                            >
                                Connections
                            </button>
                        </div>
                    </div>
                    
                    <!-- Tab Content -->
                    <div>
                        <!-- Offense History Tab -->
                        <div x-show="profileTab === 'history'" class="space-y-4">
                            <template x-if="currentCriminal.offenses && currentCriminal.offenses.length > 0">
                                <div class="space-y-4">
                                    <template x-for="(offense, index) in currentCriminal.offenses" :key="index">
                                        <div class="p-4 rounded bg-gray-700 space-y-2">
                                            <div class="flex justify-between">
                                                <h4 class="font-medium" x-text="offense.type"></h4>
                                                <span class="text-sm text-gray-400" x-text="offense.date"></span>
                                            </div>
                                            <p class="text-sm text-gray-300" x-text="offense.description"></p>
                                            <div class="text-sm text-gray-400 flex items-center">
                                                <i class="bi bi-geo-alt mr-1"></i>
                                                <span x-text="offense.location"></span>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </template>
                            
                            <template x-if="!currentCriminal.offenses || currentCriminal.offenses.length === 0">
                                <div class="text-center py-8 text-gray-400">
                                    <i class="bi bi-clipboard-x text-4xl mb-2"></i>
                                    <p>No offense history found</p>
                                </div>
                            </template>
                        </div>
                        
                        <!-- Map Timeline Tab -->
                        <div x-show="profileTab === 'timeline'" class="space-y-4">
                            <div id="timeline-map" class="h-64 rounded"></div>
                            
                            <div class="space-y-2">
                                <h4 class="font-medium">Activity Timeline</h4>
                                <div class="space-y-4">
                                    <template x-if="currentCriminal.timeline && currentCriminal.timeline.length > 0">
                                        <div class="relative border-l-2 border-gray-700 pl-6 py-2 space-y-8">
                                            <template x-for="(event, index) in currentCriminal.timeline" :key="index">
                                                <div class="relative">
                                                    <div class="absolute -left-[29px] top-0 w-4 h-4 rounded-full bg-secondary"></div>
                                                    <div class="space-y-1">
                                                        <div class="flex justify-between">
                                                            <h5 class="font-medium" x-text="event.type"></h5>
                                                            <span class="text-sm text-gray-400" x-text="event.date"></span>
                                                        </div>
                                                        <p class="text-sm text-gray-300" x-text="event.description"></p>
                                                        <div class="text-sm text-gray-400 flex items-center">
                                                            <i class="bi bi-geo-alt mr-1"></i>
                                                            <span x-text="event.location"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </template>
                                        </div>
                                    </template>
                                    
                                    <template x-if="!currentCriminal.timeline || currentCriminal.timeline.length === 0">
                                        <div class="text-center py-4 text-gray-400">
                                            <p>No timeline data available</p>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Connections Tab -->
                        <div x-show="profileTab === 'connections'" class="space-y-4">
                            <div class="bg-gray-800 rounded p-4">
                                <canvas id="connections-graph" class="w-full h-64"></canvas>
                            </div>
                            
                            <div class="space-y-2">
                                <h4 class="font-medium">Known Associates</h4>
                                
                                <template x-if="currentCriminal.connections && currentCriminal.connections.length > 0">
                                    <div class="space-y-3">
                                        <template x-for="(connection, index) in currentCriminal.connections" :key="index">
                                            <div 
                                                @click="viewCriminalProfile(connection.id)" 
                                                class="p-3 rounded bg-gray-700 flex items-center space-x-3 cursor-pointer hover:bg-gray-600 transition"
                                            >
                                                <div class="w-10 h-10 rounded-full bg-gray-500 overflow-hidden flex-shrink-0">
                                                    <img 
                                                        :src="connection.avatar" 
                                                        class="w-full h-full object-cover"
                                                        alt="Associate profile"
                                                    >
                                                </div>
                                                <div class="flex-grow">
                                                    <h5 class="font-medium" x-text="connection.name"></h5>
                                                    <p class="text-xs text-gray-400" x-text="connection.relationship"></p>
                                                </div>
                                                <div class="flex-shrink-0">
                                                    <i class="bi bi-chevron-right text-gray-400"></i>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </template>
                                
                                <template x-if="!currentCriminal.connections || currentCriminal.connections.length === 0">
                                    <div class="text-center py-4 text-gray-400">
                                        <p>No known associates</p>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Button -->
                    <button 
                        @click="addToWatchlist(currentCriminal.id)" 
                        class="w-full p-3 rounded bg-accent text-white font-semibold hover:bg-opacity-90 transition"
                    >
                        <i class="bi bi-eye mr-2"></i>
                        <span x-text="currentCriminal.inWatchlist ? 'Remove from Watchlist' : 'Add to Watchlist'"></span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Dashboard Screen -->
        <template x-if="currentScreen === 'dashboard'">
            <div class="min-h-screen p-4 pb-24 space-y-6">
                <h1 class="text-2xl font-bold">Analytics Dashboard</h1>
                
                <!-- Stat Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div class="bg-primary rounded-lg p-4 shadow">
                        <h3 class="text-lg text-gray-400">Total Reports</h3>
                        <div class="flex items-center mt-2">
                            <span class="text-3xl font-bold" x-text="stats.totalReports"></span>
                            <span 
                                class="ml-2 text-sm px-2 py-1 rounded"
                                :class="stats.reportChange >= 0 ? 'bg-green-900 text-green-400' : 'bg-red-900 text-red-400'"
                            >
                                <i 
                                    :class="stats.reportChange >= 0 ? 'bi bi-arrow-up' : 'bi bi-arrow-down'"
                                ></i>
                                <span x-text="`${Math.abs(stats.reportChange)}%`"></span>
                            </span>
                        </div>
                    </div>
                    
                    <div class="bg-primary rounded-lg p-4 shadow">
                        <h3 class="text-lg text-gray-400">Arrest Rate</h3>
                        <div class="flex items-center mt-2">
                            <span class="text-3xl font-bold" x-text="`${stats.arrestRate}%`"></span>
                            <span 
                                class="ml-2 text-sm px-2 py-1 rounded"
                                :class="stats.arrestRateChange >= 0 ? 'bg-green-900 text-green-400' : 'bg-red-900 text-red-400'"
                            >
                                <i 
                                    :class="stats.arrestRateChange >= 0 ? 'bi bi-arrow-up' : 'bi bi-arrow-down'"
                                ></i>
                                <span x-text="`${Math.abs(stats.arrestRateChange)}%`"></span>
                            </span>
                        </div>
                    </div>
                    
                    <div class="bg-primary rounded-lg p-4 shadow">
                        <h3 class="text-lg text-gray-400">Top Crime Types</h3>
                        <ul class="mt-2 space-y-1">
                            <template x-for="(crime, index) in stats.topCrimes" :key="index">
                                <li class="flex items-center justify-between text-sm">
                                    <span x-text="crime.type"></span>
                                    <span 
                                        class="px-2 rounded-full text-xs"
                                        :class="{
                                            'bg-accent bg-opacity-20 text-accent': index === 0,
                                            'bg-secondary bg-opacity-20 text-secondary': index === 1,
                                            'bg-yellow-600 bg-opacity-20 text-yellow-500': index === 2
                                        }"
                                        x-text="`${crime.percentage}%`"
                                    ></span>
                                </li>
                            </template>
                        </ul>
                    </div>
                </div>
                
                <!-- Crime Trend Chart -->
                <div class="bg-primary rounded-lg p-4 shadow space-y-2">
                    <h3 class="text-lg font-medium">Crime Trend (Last 12 Months)</h3>
                    <div>
                        <canvas id="trend-chart" class="w-full h-64"></canvas>
                    </div>
                </div>
                
                <!-- Crimes by District Chart -->
                <div class="bg-primary rounded-lg p-4 shadow space-y-2">
                    <h3 class="text-lg font-medium">Crimes by District</h3>
                    <div>
                        <canvas id="district-chart" class="w-full h-72"></canvas>
                    </div>
                </div>
                
                <!-- Hotspot Table -->
                <div class="bg-primary rounded-lg p-4 shadow space-y-4">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-medium">Crime Hotspots</h3>
                        <button 
                            @click="exportCSV" 
                            class="px-3 py-1 rounded bg-accent text-white text-sm flex items-center"
                        >
                            <i class="bi bi-download mr-1"></i> Export CSV
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead>
                                <tr class="bg-gray-700">
                                    <th class="py-2 px-3 text-left text-sm text-gray-300">Location</th>
                                    <th class="py-2 px-3 text-left text-sm text-gray-300">Crime Type</th>
                                    <th class="py-2 px-3 text-left text-sm text-gray-300">Incidents</th>
                                    <th class="py-2 px-3 text-left text-sm text-gray-300">Risk Level</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-700">
                                <template x-for="(hotspot, index) in stats.hotspots" :key="index">
                                    <tr class="hover:bg-gray-800 transition">
                                        <td class="py-2 px-3 text-sm" x-text="hotspot.location"></td>
                                        <td class="py-2 px-3 text-sm" x-text="hotspot.crimeType"></td>
                                        <td class="py-2 px-3 text-sm" x-text="hotspot.incidents"></td>
                                        <td class="py-2 px-3 text-sm">
                                            <span 
                                                class="px-2 py-1 rounded text-xs"
                                                :class="{
                                                    'bg-red-900 text-red-400': hotspot.riskLevel === 'High',
                                                    'bg-yellow-900 text-yellow-400': hotspot.riskLevel === 'Medium',
                                                    'bg-green-900 text-green-400': hotspot.riskLevel === 'Low'
                                                }"
                                                x-text="hotspot.riskLevel"
                                            ></span>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </template>

        <!-- Profile Screen -->
        <template x-if="currentScreen === 'profile'">
            <div class="min-h-screen p-4 pb-24 space-y-6">
                <div class="bg-primary rounded-lg p-4 shadow space-y-4 text-center">
                    <div class="w-24 h-24 rounded-full bg-gray-700 mx-auto overflow-hidden">
                        <img 
                            src="https://source.unsplash.com/random/100x100/?avatar" 
                            class="w-full h-full object-cover"
                            alt="User profile"
                        >
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold" x-text="userProfile.name"></h1>
                        <p class="text-gray-400" x-text="userProfile.email"></p>
                        <div class="mt-2 inline-block px-3 py-1 rounded-full bg-secondary bg-opacity-20 text-secondary">
                            <span x-text="userProfile.role"></span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-primary rounded-lg shadow divide-y divide-gray-700">
                    <div class="p-4">
                        <h3 class="text-lg font-medium mb-4">Account Settings</h3>
                        <ul class="space-y-3">
                            <li>
                                <button class="w-full flex items-center justify-between p-2 hover:bg-gray-700 rounded transition">
                                    <div class="flex items-center">
                                        <i class="bi bi-person-fill text-xl mr-3 text-gray-400"></i>
                                        <span>Edit Profile</span>
                                    </div>
                                    <i class="bi bi-chevron-right text-gray-400"></i>
                                </button>
                            </li>
                            <li>
                                <button class="w-full flex items-center justify-between p-2 hover:bg-gray-700 rounded transition">
                                    <div class="flex items-center">
                                        <i class="bi bi-bell-fill text-xl mr-3 text-gray-400"></i>
                                        <span>Notification Settings</span>
                                    </div>
                                    <i class="bi bi-chevron-right text-gray-400"></i>
                                </button>
                            </li>
                            <li>
                                <button class="w-full flex items-center justify-between p-2 hover:bg-gray-700 rounded transition">
                                    <div class="flex items-center">
                                        <i class="bi bi-shield-lock-fill text-xl mr-3 text-gray-400"></i>
                                        <span>Privacy & Security</span>
                                    </div>
                                    <i class="bi bi-chevron-right text-gray-400"></i>
                                </button>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="p-4">
                        <h3 class="text-lg font-medium mb-4">Watchlist</h3>
                        <template x-if="userProfile.watchlist && userProfile.watchlist.length > 0">
                            <ul class="space-y-3">
                                <template x-for="(item, index) in userProfile.watchlist" :key="index">
                                    <li>
                                        <button 
                                            @click="viewCriminalProfile(item.id)"
                                            class="w-full flex items-center justify-between p-2 hover:bg-gray-700 rounded transition"
                                        >
                                            <div class="flex items-center">
                                                <div class="w-10 h-10 rounded-full bg-gray-600 overflow-hidden mr-3">
                                                    <img 
                                                        :src="item.avatar" 
                                                        class="w-full h-full object-cover"
                                                        alt="Watchlist item"
                                                    >
                                                </div>
                                                <div class="text-left">
                                                    <p class="font-medium" x-text="item.name"></p>
                                                    <p class="text-sm text-gray-400" x-text="item.status"></p>
                                                </div>
                                            </div>
                                            <i class="bi bi-chevron-right text-gray-400"></i>
                                        </button>
                                    </li>
                                </template>
                            </ul>
                        </template>
                        
                        <template x-if="!userProfile.watchlist || userProfile.watchlist.length === 0">
                            <div class="text-center py-4 text-gray-400">
                                <i class="bi bi-eye-slash text-3xl mb-2"></i>
                                <p>No criminals in your watchlist</p>
                            </div>
                        </template>
                    </div>
                    
                    <div class="p-4">
                        <h3 class="text-lg font-medium mb-4">App Settings</h3>
                        <ul class="space-y-4">
                            <li class="flex items-center justify-between p-2">
                                <div class="flex items-center">
                                    <i class="bi bi-moon-fill text-xl mr-3 text-gray-400"></i>
                                    <span>Dark Mode</span>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-700 rounded-full peer peer-checked:bg-accent"></div>
                                </label>
                            </li>
                            <li class="flex items-center justify-between p-2">
                                <div class="flex items-center">
                                    <i class="bi bi-geo-alt-fill text-xl mr-3 text-gray-400"></i>
                                    <span>Location Services</span>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-700 rounded-full peer peer-checked:bg-accent"></div>
                                </label>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="p-4">
                        <button 
                            @click="logout" 
                            class="w-full p-3 rounded bg-gray-700 text-accent font-semibold hover:bg-gray-600 transition flex items-center justify-center"
                        >
                            <i class="bi bi-box-arrow-right mr-2"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </template>
    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('app', () => ({
                isLoading: false,
                loadingMessage: 'Loading...',
                isLoggedIn: false,
                currentScreen: 'home',
                showPassword: false,
                showSignupPassword: false,
                showReportCrime: false,
                showSignup: false,
                showSmartRouteModal: false,
                showNotifications: false,
                showFilterPanel: true,
                showPredictions: false,
                map: null,
                geocoder: null,
                reportGeocoder: null,
                startLocationGeocoder: null,
                destinationGeocoder: null,
                searchTab: 'name',
                showFaceSearchModal: false,
                tempFaceImage: null,
                faceSearchImage: null,
                showCriminalProfile: false,
                profileTab: 'history',
                crimeMarkers: [],
                predictionMarkers: [],
                loginForm: {
                    email: '',
                    password: ''
                },
                signupForm: {
                    name: '',
                    email: '',
                    password: '',
                    role: ''
                },
                filters: {
                    crimeType: 'all',
                    startDate: '',
                    endDate: '',
                    severity: 3
                },
                smartRouteSettings: {
                    safetyPriority: 5,
                    mode: 'walking'
                },
                crimeReport: {
                    type: '',
                    datetime: '',
                    location: '',
                    description: '',
                    media: []
                },
                searchQuery: '',
                isSearching: false,
                searchResults: [],
                faceSearchResults: [],
                currentCriminal: {},
                notifications: [
                    {
                        type: 'proximity',
                        message: 'New theft report 500m away',
                        time: '10 minutes ago',
                        read: false
                    },
                    {
                        type: 'alert',
                        message: 'You are entering a high-risk zone',
                        time: '2 minutes ago',
                        read: false
                    },
                    {
                        type: 'info',
                        message: 'Crime prediction updated for your area',
                        time: '1 hour ago',
                        read: true
                    }
                ],
                userProfile: {
                    name: 'John Doe',
                    email: 'john.doe@example.com',
                    role: 'Citizen',
                    watchlist: [
                        {
                            id: 1,
                            name: 'Alex Johnson',
                            avatar: 'https://source.unsplash.com/random/100x100/?man,1',
                            status: 'Active'
                        },
                        {
                            id: 2,
                            name: 'Maria Garcia',
                            avatar: 'https://source.unsplash.com/random/100x100/?woman,1',
                            status: 'Released'
                        }
                    ]
                },
                stats: {
                    totalReports: 1247,
                    reportChange: 12,
                    arrestRate: 68,
                    arrestRateChange: -2,
                    topCrimes: [
                        { type: 'Theft', percentage: 32 },
                        { type: 'Assault', percentage: 24 },
                        { type: 'Vandalism', percentage: 18 }
                    ],
                    hotspots: [
                        { location: 'Downtown East', crimeType: 'Theft', incidents: 78, riskLevel: 'High' },
                        { location: 'Westside Mall', crimeType: 'Robbery', incidents: 45, riskLevel: 'High' },
                        { location: 'North Station', crimeType: 'Assault', incidents: 52, riskLevel: 'Medium' },
                        { location: 'Riverside Park', crimeType: 'Vandalism', incidents: 34, riskLevel: 'Medium' },
                        { location: 'South Harbor', crimeType: 'Theft', incidents: 28, riskLevel: 'Low' }
                    ]
                },
                
                init() {
                    this.$watch('currentScreen', (value) => {
                        if (value === 'home') {
                            this.initMap();
                        } else if (value === 'dashboard') {
                            this.$nextTick(() => {
                                this.initCharts();
                            });
                        }
                    });
                    
                    this.$watch('showCriminalProfile', (value) => {
                        if (value && this.profileTab === 'timeline') {
                            this.$nextTick(() => {
                                this.initTimelineMap();
                            });
                        }
                    });
                    
                    this.$watch('profileTab', (value) => {
                        if (value === 'timeline' && this.showCriminalProfile) {
                            this.$nextTick(() => {
                                this.initTimelineMap();
                            });
                        } else if (value === 'connections' && this.showCriminalProfile) {
                            this.$nextTick(() => {
                                this.initConnectionsGraph();
                            });
                        }
                    });
                },
                
                async login() {
                    this.isLoading = true;
                    this.loadingMessage = 'Logging in...';
                    
                    try {
                        // Simulate API call
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        
                        this.isLoggedIn = true;
                        this.currentScreen = 'home';
                        
                        // Initialize map after login
                        this.$nextTick(() => {
                            this.initMap();
                        });
                    } catch (error) {
                        console.error('Login error:', error);
                        alert('Login failed. Please check your credentials and try again.');
                    } finally {
                        this.isLoading = false;
                    }
                },
                
                async register() {
                    this.isLoading = true;
                    this.loadingMessage = 'Creating your account...';
                    
                    try {
                        // Simulate API call
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        
                        this.showSignup = false;
                        alert('Account created successfully! Please log in.');
                    } catch (error) {
                        console.error('Registration error:', error);
                        alert('Registration failed. Please try again.');
                    } finally {
                        this.isLoading = false;
                    }
                },
                
                logout() {
                    this.isLoggedIn = false;
                    this.loginForm = {
                        email: '',
                        password: ''
                    };
                },
                
                initMap() {
                    if (this.map) {
                        return; // Map already initialized
                    }
                    
                    this.isLoading = true;
                    this.loadingMessage = 'Loading map...';
                    
                    // Replace with your actual Mapbox token or use a free alternative
                    mapboxgl.accessToken = 'pk.eyJ1IjoiY29kZWJyYWluIiwiYSI6ImNsb2J2OXJvcTAyY3Qya3A1ZDRsanN2bXkifQ.7Vck4jhUCZ5ikRvHZgxQfA';
                    
                    this.map = new mapboxgl.Map({
                        container: 'map',
                        style: 'mapbox://styles/mapbox/dark-v11',
                        center: [-74.0066, 40.7135], // Default to NYC
                        zoom: 12
                    });
                    
                    this.map.on('load', () => {
                        // Add navigation control
                        this.map.addControl(new mapboxgl.NavigationControl(), 'top-right');
                        
                        // Add geolocate control
                        const geolocate = new mapboxgl.GeolocateControl({
                            positionOptions: {
                                enableHighAccuracy: true
                            },
                            trackUserLocation: true,
                            showUserHeading: true
                        });
                        
                        this.map.addControl(geolocate);
                        
                        // Trigger geolocation on map load
                        this.map.once('idle', () => {
                            geolocate.trigger();
                            
                            // Add crime data points
                            this.loadCrimeData();
                            
                            // Add geocoder for report form
                            this.initGeocoders();
                            
                            this.isLoading = false;
                        });
                    });
                    
                    this.map.on('error', () => {
                        this.isLoading = false;
                        alert('Error loading map. Please check your connection and try again.');
                    });
                },
                
                initGeocoders() {
                    // Report location geocoder
                    this.reportGeocoder = new MapboxGeocoder({
                        accessToken: mapboxgl.accessToken,
                        mapboxgl: mapboxgl,
                        placeholder: 'Enter crime location',
                        marker: false
                    });
                    
                    document.getElementById('report-location-input').appendChild(
                        this.reportGeocoder.onAdd(this.map)
                    );
                    
                    // Smart route geocoders
                    this.startLocationGeocoder = new MapboxGeocoder({
                        accessToken: mapboxgl.accessToken,
                        mapboxgl: mapboxgl,
                        placeholder: 'Enter start location',
                        marker: false
                    });
                    
                    document.getElementById('start-location-input').appendChild(
                        this.startLocationGeocoder.onAdd(this.map)
                    );
                    
                    this.destinationGeocoder = new MapboxGeocoder({
                        accessToken: mapboxgl.accessToken,
                        mapboxgl: mapboxgl,
                        placeholder: 'Enter destination',
                        marker: false
                    });
                    
                    document.getElementById('destination-input').appendChild(
                        this.destinationGeocoder.onAdd(this.map)
                    );
                },
                
                loadCrimeData() {
                    // Sample crime data
                    const crimeData = [
                        { type: 'theft', lat: 40.7135, lng: -74.0066, severity: 3, date: '2023-10-15' },
                        { type: 'assault', lat: 40.7235, lng: -74.0166, severity: 4, date: '2023-10-10' },
                        { type: 'vandalism', lat: 40.7335, lng: -73.9966, severity: 2, date: '2023-10-12' },
                        { type: 'burglary', lat: 40.7435, lng: -74.0266, severity: 3, date: '2023-10-14' },
                        { type: 'robbery', lat: 40.7535, lng: -73.9866, severity: 5, date: '2023-10-08' },
                        { type: 'theft', lat: 40.7635, lng: -74.0366, severity: 2, date: '2023-10-11' },
                        { type: 'assault', lat: 40.7735, lng: -73.9766, severity: 4, date: '2023-10-09' },
                        { type: 'vandalism', lat: 40.7835, lng: -74.0466, severity: 2, date: '2023-10-13' }
                    ];
                    
                    // Create markers for each crime
                    crimeData.forEach(crime => {
                        const markerElement = document.createElement('div');
                        markerElement.className = 'w-4 h-4 rounded-full';
                        
                        // Set color based on crime type
                        switch (crime.type) {
                            case 'theft':
                                markerElement.style.backgroundColor = '#3498db';
                                break;
                            case 'assault':
                                markerElement.style.backgroundColor = '#e74c3c';
                                break;
                            case 'vandalism':
                                markerElement.style.backgroundColor = '#2ecc71';
                                break;
                            case 'burglary':
                                markerElement.style.backgroundColor = '#f39c12';
                                break;
                            case 'robbery':
                                markerElement.style.backgroundColor = '#9b59b6';
                                break;
                            default:
                                markerElement.style.backgroundColor = '#95a5a6';
                        }
                        
                        // Create and add the marker
                        const marker = new mapboxgl.Marker(markerElement)
                            .setLngLat([crime.lng, crime.lat])
                            .addTo(this.map);
                        
                        // Add popup with crime details
                        const popup = new mapboxgl.Popup({ offset: 25 })
                            .setHTML(`
                                <div>
                                    <h3 class="text-white font-semibold capitalize">${crime.type}</h3>
                                    <p class="text-sm text-gray-300">Date: ${crime.date}</p>
                                    <p class="text-sm text-gray-300">Severity: ${crime.severity}/5</p>
                                    <button class="mt-2 text-xs text-accent">View Details</button>
                                </div>
                            `);
                        
                        marker.setPopup(popup);
                        
                        // Store marker for filtering
                        this.crimeMarkers.push({
                            marker,
                            type: crime.type,
                            severity: crime.severity,
                            date: crime.date
                        });
                    });
                    
                    // Add prediction hotspots
                    const predictionData = [
                        { lat: 40.7215, lng: -74.0016, risk: 'High burglary risk after 9 PM' },
                        { lat: 40.7315, lng: -73.9916, risk: 'High theft risk in afternoons' },
                        { lat: 40.7415, lng: -74.0216, risk: 'Medium assault risk on weekends' }
                    ];
                    
                    predictionData.forEach(pred => {
                        const element = document.createElement('div');
                        element.className = 'pulsing-circle';
                        
                        const marker = new mapboxgl.Marker(element)
                            .setLngLat([pred.lng, pred.lat]);
                        
                        const popup = new mapboxgl.Popup({ offset: 25 })
                            .setHTML(`
                                <div>
                                    <h3 class="text-white font-semibold">Prediction</h3>
                                    <p class="text-sm text-gray-300">${pred.risk}</p>
                                </div>
                            `);
                        
                        marker.setPopup(popup);
                        
                        // Store prediction markers separately
                        this.predictionMarkers.push({ marker, visible: false });
                    });
                },
                
                togglePredictions() {
                    this.showPredictions = !this.showPredictions;
                    
                    // Show/hide prediction markers
                    this.predictionMarkers.forEach(pred => {
                        if (this.showPredictions) {
                            if (!pred.visible) {
                                pred.marker.addTo(this.map);
                                pred.visible = true;
                            }
                        } else {
                            if (pred.visible) {
                                pred.marker.remove();
                                pred.visible = false;
                            }
                        }
                    });
                },
                
                toggleFilterPanel() {
                    this.showFilterPanel = !this.showFilterPanel;
                },
                
                applyFilters() {
                    // Filter crime markers based on selected criteria
                    this.crimeMarkers.forEach(marker => {
                        // Filter by type
                        const typeMatch = this.filters.crimeType === 'all' || marker.type === this.filters.crimeType;
                        
                        // Filter by severity
                        const severityMatch = marker.severity >= this.filters.severity;
                        
                        // Filter by date range
                        let dateMatch = true;
                        if (this.filters.startDate && this.filters.endDate) {
                            const markerDate = new Date(marker.date);
                            const startDate = new Date(this.filters.startDate);
                            const endDate = new Date(this.filters.endDate);
                            dateMatch = markerDate >= startDate && markerDate <= endDate;
                        }
                        
                        // Show/hide marker based on filters
                        if (typeMatch && severityMatch && dateMatch) {
                            marker.marker.getElement().style.display = 'block';
                        } else {
                            marker.marker.getElement().style.display = 'none';
                        }
                    });
                },
                
                calculateSmartRoute() {
                    this.isLoading = true;
                    this.loadingMessage = 'Calculating safest route...';
                    
                    setTimeout(() => {
                        // Simulate route calculation
                        this.showSmartRouteModal = false;
                        this.isLoading = false;
                        
                        // Add a sample route to the map
                        if (this.map.getSource('route')) {
                            this.map.removeLayer('route');
                            this.map.removeSource('route');
                        }
                        
                        // Sample route coordinates
                        const routeCoordinates = [
                            [-74.0066, 40.7135],
                            [-74.0046, 40.7165],
                            [-73.9966, 40.7185],
                            [-73.9916, 40.7215],
                            [-73.9876, 40.7235]
                        ];
                        
                        this.map.addSource('route', {
                            'type': 'geojson',
                            'data': {
                                'type': 'Feature',
                                'properties': {},
                                'geometry': {
                                    'type': 'LineString',
                                    'coordinates': routeCoordinates
                                }
                            }
                        });
                        
                        this.map.addLayer({
                            'id': 'route',
                            'type': 'line',
                            'source': 'route',
                            'layout': {
                                'line-join': 'round',
                                'line-cap': 'round'
                            },
                            'paint': {
                                'line-color': '#3498db',
                                'line-width': 5,
                                'line-opacity': 0.8
                            }
                        });
                        
                        // Pan to the route
                        this.map.fitBounds([
                            [Math.min(...routeCoordinates.map(coord => coord[0])) - 0.01, Math.min(...routeCoordinates.map(coord => coord[1])) - 0.01],
                            [Math.max(...routeCoordinates.map(coord => coord[0])) + 0.01, Math.max(...routeCoordinates.map(coord => coord[1])) + 0.01]
                        ]);
                        
                        // Show a success message
                        alert('Safe route calculated! This route avoids 3 high-risk areas.');
                    }, 1500);
                },
                
                capturePhoto() {
                    // Simulate camera functionality
                    document.getElementById('fileInput').click();
                },
                
                uploadFromGallery() {
                    // Trigger file input
                    document.getElementById('fileInput').click();
                },
                
                async handleFileUpload(event) {
                    if (event.target.files.length === 0) return;
                    
                    const file = event.target.files[0];
                    this.isLoading = true;
                    this.loadingMessage = 'Uploading media...';
                    
                    try {
                        // Simulate file upload API call
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        
                        // Create a temporary URL for the image
                        const imageUrl = URL.createObjectURL(file);
                        
                        // Add the media to the report
                        this.crimeReport.media.push({
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            url: imageUrl
                        });
                        
                        // Reset file input
                        event.target.value = '';
                    } catch (error) {
                        console.error('File upload error:', error);
                        alert('Failed to upload file. Please try again.');
                    } finally {
                        this.isLoading = false;
                    }
                },
                
                removeMedia(index) {
                    this.crimeReport.media.splice(index, 1);
                },
                
                async submitCrimeReport() {
                    if (!this.crimeReport.type) {
                        alert('Please select a crime type');
                        return;
                    }
                    
                    if (!this.crimeReport.datetime) {
                        alert('Please enter the date and time');
                        return;
                    }
                    
                    this.isLoading = true;
                    this.loadingMessage = 'Submitting report...';
                    
                    try {
                        // Simulate API call to submit report
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        
                        // Reset form
                        this.crimeReport = {
                            type: '',
                            datetime: '',
                            location: '',
                            description: '',
                            media: []
                        };
                        
                        this.showReportCrime = false;
                        alert('Thank you! Your report has been submitted successfully.');
                        
                        // Add a new notification
                        this.notifications.unshift({
                            type: 'info',
                            message: 'Your crime report was submitted successfully',
                            time: 'Just now',
                            read: false
                        });
                    } catch (error) {
                        console.error('Report submission error:', error);
                        alert('Failed to submit report. Please try again.');
                    } finally {
                        this.isLoading = false;
                    }
                },
                
                markNotificationAsRead(index) {
                    this.notifications[index].read = true;
                },
                
                performSearch() {
                    if (this.searchQuery.length < 2) {
                        this.searchResults = [];
                        return;
                    }
                    
                    this.isSearching = true;
                    
                    // Simulate API call for search
                    setTimeout(() => {
                        // Mock search results
                        this.searchResults = [
                            {
                                id: 1,
                                name: 'Alex Johnson',
                                summary: 'Theft, Assault (2 counts)',
                                avatar: 'https://source.unsplash.com/random/100x100/?man,1'
                            },
                            {
                                id: 2,
                                name: 'Maria Garcia',
                                summary: 'Robbery (1 count)',
                                avatar: 'https://source.unsplash.com/random/100x100/?woman,1'
                            },
                            {
                                id: 3,
                                name: 'James Wilson',
                                summary: 'Burglary (3 counts), Theft',
                                avatar: 'https://source.unsplash.com/random/100x100/?man,2'
                            }
                        ].filter(result => 
                            result.name.toLowerCase().includes(this.searchQuery.toLowerCase()) ||
                            result.summary.toLowerCase().includes(this.searchQuery.toLowerCase())
                        );
                        
                        this.isSearching = false;
                    }, 800);
                },
                
                clearSearch() {
                    this.searchQuery = '';
                    this.searchResults = [];
                },
                
                captureFacePhoto() {
                    // Simulate camera functionality
                    document.getElementById('faceFileInput').click();
                },
                
                uploadFaceFromGallery() {
                    // Trigger file input
                    document.getElementById('faceFileInput').click();
                },
                
                handleFaceFileUpload(event) {
                    if (event.target.files.length === 0) return;
                    
                    const file = event.target.files[0];
                    const imageUrl = URL.createObjectURL(file);
                    this.tempFaceImage = imageUrl;
                    
                    // Reset file input
                    event.target.value = '';
                },
                
                confirmFaceSearch() {
                    this.faceSearchImage = this.tempFaceImage;
                    this.tempFaceImage = null;
                    this.showFaceSearchModal = false;
                    this.searchTab = 'face';
                    
                    this.isLoading = true;
                    this.loadingMessage = 'Analyzing face...';
                    
                    // Simulate API call for face recognition
                    setTimeout(() => {
                        // Mock face search results
                        this.faceSearchResults = [
                            {
                                id: 1,
                                name: 'Alex Johnson',
                                matchPercentage: 87,
                                avatar: 'https://source.unsplash.com/random/100x100/?man,1'
                            },
                            {
                                id: 3,
                                name: 'James Wilson',
                                matchPercentage: 62,
                                avatar: 'https://source.unsplash.com/random/100x100/?man,2'
                            }
                        ];
                        
                        this.isLoading = false;
                    }, 2000);
                },
                
                clearFaceSearch() {
                    this.faceSearchImage = null;
                    this.faceSearchResults = [];
                },
                
                viewCriminalProfile(id) {
                    this.isLoading = true;
                    this.loadingMessage = 'Loading profile...';
                    
                    // Simulate API call to fetch criminal profile
                    setTimeout(() => {
                        // Mock criminal profile data
                        if (id === 1) {
                            this.currentCriminal = {
                                id: 1,
                                name: 'Alex Johnson',
                                status: 'Active',
                                lastSeen: 'Last seen 2 days ago',
                                avatar: 'https://source.unsplash.com/random/100x100/?man,1',
                                inWatchlist: true,
                                offenses: [
                                    {
                                        type: 'Theft',
                                        date: '2023-06-15',
                                        description: 'Shoplifting at Downtown Mall',
                                        location: 'Downtown East'
                                    },
                                    {
                                        type: 'Assault',
                                        date: '2023-04-22',
                                        description: 'Physical altercation at a bar',
                                        location: 'Westside District'
                                    },
                                    {
                                        type: 'Assault',
                                        date: '2022-11-08',
                                        description: 'Threatening behavior toward public transit employee',
                                        location: 'North Station'
                                    }
                                ],
                                timeline: [
                                    {
                                        type: 'Arrest',
                                        date: '2023-06-16',
                                        description: 'Arrested for theft at Downtown Mall',
                                        location: 'Downtown East'
                                    },
                                    {
                                        type: 'Release',
                                        date: '2023-06-18',
                                        description: 'Released on bail',
                                        location: 'Central Precinct'
                                    },
                                    {
                                        type: 'Court Appearance',
                                        date: '2023-07-05',
                                        description: 'Initial hearing for theft charge',
                                        location: 'City Courthouse'
                                    }
                                ],
                                connections: [
                                    {
                                        id: 3,
                                        name: 'James Wilson',
                                        relationship: 'Known associate',
                                        avatar: 'https://source.unsplash.com/random/100x100/?man,2'
                                    },
                                    {
                                        id: 4,
                                        name: 'Sarah Thompson',
                                        relationship: 'Accomplice in theft case',
                                        avatar: 'https://source.unsplash.com/random/100x100/?woman,2'
                                    }
                                ]
                            };
                        } else if (id === 2) {
                            this.currentCriminal = {
                                id: 2,
                                name: 'Maria Garcia',
                                status: 'Released',
                                lastSeen: 'Last seen 5 days ago',
                                avatar: 'https://source.unsplash.com/random/100x100/?woman,1',
                                inWatchlist: true,
                                offenses: [
                                    {
                                        type: 'Robbery',
                                        date: '2022-12-10',
                                        description: 'Armed robbery at convenience store',
                                        location: 'South Harbor'
                                    }
                                ],
                                timeline: [
                                    {
                                        type: 'Arrest',
                                        date: '2022-12-12',
                                        description: 'Arrested for robbery',
                                        location: 'South Harbor'
                                    },
                                    {
                                        type: 'Court Appearance',
                                        date: '2023-01-15',
                                        description: 'Trial for robbery charge',
                                        location: 'City Courthouse'
                                    },
                                    {
                                        type: 'Release',
                                        date: '2023-08-20',
                                        description: 'Released after serving sentence',
                                        location: 'State Correctional Facility'
                                    }
                                ],
                                connections: []
                            };
                        } else if (id === 3) {
                            this.currentCriminal = {
                                id: 3,
                                name: 'James Wilson',
                                status: 'Active',
                                lastSeen: 'Last seen yesterday',
                                avatar: 'https://source.unsplash.com/random/100x100/?man,2',
                                inWatchlist: false,
                                offenses: [
                                    {
                                        type: 'Burglary',
                                        date: '2023-02-05',
                                        description: 'Residential burglary',
                                        location: 'Eastside Heights'
                                    },
                                    {
                                        type: 'Burglary',
                                        date: '2023-03-12',
                                        description: 'Commercial burglary at electronics store',
                                        location: 'Downtown West'
                                    },
                                    {
                                        type: 'Burglary',
                                        date: '2023-05-20',
                                        description: 'Breaking and entering at warehouse',
                                        location: 'Industrial District'
                                    },
                                    {
                                        type: 'Theft',
                                        date: '2023-07-08',
                                        description: 'Theft of vehicle parts',
                                        location: 'Westside Mall Parking'
                                    }
                                ],
                                timeline: [
                                    {
                                        type: 'Arrest',
                                        date: '2023-05-21',
                                        description: 'Arrested for warehouse burglary',
                                        location: 'Industrial District'
                                    },
                                    {
                                        type: 'Release',
                                        date: '2023-05-25',
                                        description: 'Released on bail',
                                        location: 'Central Precinct'
                                    },
                                    {
                                        type: 'Court Appearance',
                                        date: '2023-06-15',
                                        description: 'Initial hearing for multiple burglary charges',
                                        location: 'City Courthouse'
                                    }
                                ],
                                connections: [
                                    {
                                        id: 1,
                                        name: 'Alex Johnson',
                                        relationship: 'Known associate',
                                        avatar: 'https://source.unsplash.com/random/100x100/?man,1'
                                    }
                                ]
                            };
                        } else {
                            this.currentCriminal = {
                                id: 4,
                                name: 'Sarah Thompson',
                                status: 'Active',
                                lastSeen: 'Last seen 3 days ago',
                                avatar: 'https://source.unsplash.com/random/100x100/?woman,2',
                                inWatchlist: false,
                                offenses: [
                                    {
                                        type: 'Theft',
                                        date: '2023-06-15',
                                        description: 'Shoplifting at Downtown Mall',
                                        location: 'Downtown East'
                                    }
                                ],
                                timeline: [
                                    {
                                        type: 'Arrest',
                                        date: '2023-06-16',
                                        description: 'Arrested for theft at Downtown Mall',
                                        location: 'Downtown East'
                                    },
                                    {
                                        type: 'Release',
                                        date: '2023-06-16',
                                        description: 'Released on bail',
                                        location: 'East Precinct'
                                    }
                                ],
                                connections: [
                                    {
                                        id: 1,
                                        name: 'Alex Johnson',
                                        relationship: 'Accomplice in theft case',
                                        avatar: 'https://source.unsplash.com/random/100x100/?man,1'
                                    }
                                ]
                            };
                        }
                        
                        this.showCriminalProfile = true;
                        this.isLoading = false;
                    }, 1000);
                },
                
                initTimelineMap() {
                    if (!this.currentCriminal.timeline || this.currentCriminal.timeline.length === 0) {
                        return;
                    }
                    
                    // Sample coordinates for timeline map
                    const timelineCoordinates = [
                        [-74.0066, 40.7135], // Downtown East
                        [-74.0046, 40.7155], // Central Precinct
                        [-73.9966, 40.7175]  // City Courthouse
                    ];
                    
                    const timelineMap = new mapboxgl.Map({
                        container: 'timeline-map',
                        style: 'mapbox://styles/mapbox/dark-v11',
                        center: [-74.0026, 40.7155],
                        zoom: 12
                    });
                    
                    timelineMap.on('load', () => {
                        // Add markers for each timeline event
                        timelineCoordinates.forEach((coord, index) => {
                            const markerElement = document.createElement('div');
                            markerElement.className = 'w-4 h-4 rounded-full';
                            markerElement.style.backgroundColor = '#3498db';
                            
                            const marker = new mapboxgl.Marker(markerElement)
                                .setLngLat(coord)
                                .addTo(timelineMap);
                            
                            // Add popup with event details
                            if (this.currentCriminal.timeline[index]) {
                                const event = this.currentCriminal.timeline[index];
                                const popup = new mapboxgl.Popup({ offset: 25 })
                                    .setHTML(`
                                        <div>
                                            <h3 class="text-white font-semibold">${event.type}</h3>
                                            <p class="text-sm text-gray-300">${event.date}</p>
                                            <p class="text-sm text-gray-300">${event.location}</p>
                                        </div>
                                    `);
                                
                                marker.setPopup(popup);
                            }
                        });
                        
                        // Add a line connecting the points
                        timelineMap.addSource('timeline-route', {
                            'type': 'geojson',
                            'data': {
                                'type': 'Feature',
                                'properties': {},
                                'geometry': {
                                    'type': 'LineString',
                                    'coordinates': timelineCoordinates
                                }
                            }
                        });
                        
                        timelineMap.addLayer({
                            'id': 'timeline-route',
                            'type': 'line',
                            'source': 'timeline-route',
                            'layout': {
                                'line-join': 'round',
                                'line-cap': 'round'
                            },
                            'paint': {
                                'line-color': '#3498db',
                                'line-width': 2,
                                'line-dasharray': [2, 1]
                            }
                        });
                    });
                },
                
                initConnectionsGraph() {
                    if (!this.currentCriminal.connections || this.currentCriminal.connections.length === 0) {
                        return;
                    }
                    
                    const ctx = document.getElementById('connections-graph').getContext('2d');
                    
                    // Clear any existing charts
                    if (window.connectionChart) {
                        window.connectionChart.destroy();
                    }
                    
                    // Create a simple network visualization with Chart.js
                    // This is a simplified representation - in a real app you would use a proper graph visualization library
                    window.connectionChart = new Chart(ctx, {
                        type: 'bubble',
                        data: {
                            datasets: [
                                {
                                    label: this.currentCriminal.name,
                                    data: [{
                                        x: 0,
                                        y: 0,
                                        r: 15
                                    }],
                                    backgroundColor: 'rgba(231, 76, 60, 0.8)'
                                },
                                ...this.currentCriminal.connections.map((connection, index) => ({
                                    label: connection.name,
                                    data: [{
                                        x: Math.cos(index * Math.PI / this.currentCriminal.connections.length * 2) * 5,
                                        y: Math.sin(index * Math.PI / this.currentCriminal.connections.length * 2) * 5,
                                        r: 10
                                    }],
                                    backgroundColor: 'rgba(52, 152, 219, 0.8)'
                                }))
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: {
                                    display: false,
                                    min: -6,
                                    max: 6
                                },
                                y: {
                                    display: false,
                                    min: -6,
                                    max: 6
                                }
                            },
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return context.dataset.label;
                                        }
                                    }
                                },
                                legend: {
                                    display: true,
                                    position: 'bottom',
                                    labels: {
                                        color: '#ffffff'
                                    }
                                }
                            }
                        }
                    });
                },
                
                addToWatchlist(id) {
                    const isInWatchlist = this.currentCriminal.inWatchlist;
                    
                    if (isInWatchlist) {
                        // Remove from watchlist
                        this.userProfile.watchlist = this.userProfile.watchlist.filter(item => item.id !== id);
                        this.currentCriminal.inWatchlist = false;
                        alert('Criminal removed from your watchlist');
                    } else {
                        // Add to watchlist
                        this.userProfile.watchlist.push({
                            id: this.currentCriminal.id,
                            name: this.currentCriminal.name,
                            avatar: this.currentCriminal.avatar,
                            status: this.currentCriminal.status
                        });
                        this.currentCriminal.inWatchlist = true;
                        alert('Criminal added to your watchlist');
                    }
                },
                
                initCharts() {
                    // Crime Trend Chart
                    const trendCtx = document.getElementById('trend-chart').getContext('2d');
                    
                    // Sample data for the past 12 months
                    const months = ['Nov', 'Dec', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'];
                    
                    const trendChart = new Chart(trendCtx, {
                        type: 'line',
                        data: {
                            labels: months,
                            datasets: [
                                {
                                    label: 'Theft',
                                    data: [65, 78, 52, 45, 50, 55, 42, 48, 62, 68, 71, 58],
                                    borderColor: '#3498db',
                                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                                    tension: 0.3,
                                    fill: true
                                },
                                {
                                    label: 'Assault',
                                    data: [28, 35, 40, 42, 38, 25, 30, 34, 35, 32, 30, 25],
                                    borderColor: '#e74c3c',
                                    backgroundColor: 'rgba(231, 76, 60, 0.1)',
                                    tension: 0.3,
                                    fill: true
                                },
                                {
                                    label: 'Vandalism',
                                    data: [20, 18, 25, 30, 22, 18, 15, 20, 25, 22, 18, 15],
                                    borderColor: '#2ecc71',
                                    backgroundColor: 'rgba(46, 204, 113, 0.1)',
                                    tension: 0.3,
                                    fill: true
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: {
                                        color: '#ffffff'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#ffffff'
                                    }
                                },
                                x: {
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#ffffff'
                                    }
                                }
                            }
                        }
                    });
                    
                    // Crimes by District Chart
                    const districtCtx = document.getElementById('district-chart').getContext('2d');
                    
                    const districtChart = new Chart(districtCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Downtown', 'Westside', 'North', 'South', 'East', 'Industrial'],
                            datasets: [
                                {
                                    label: 'Theft',
                                    data: [45, 38, 32, 28, 35, 22],
                                    backgroundColor: '#3498db'
                                },
                                {
                                    label: 'Assault',
                                    data: [25, 22, 18, 20, 15, 10],
                                    backgroundColor: '#e74c3c'
                                },
                                {
                                    label: 'Vandalism',
                                    data: [15, 12, 18, 10, 8, 20],
                                    backgroundColor: '#2ecc71'
                                },
                                {
                                    label: 'Burglary',
                                    data: [20, 18, 15, 12, 18, 8],
                                    backgroundColor: '#f39c12'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: {
                                        color: '#ffffff'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    stacked: true,
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#ffffff'
                                    }
                                },
                                x: {
                                    stacked: true,
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#ffffff'
                                    }
                                }
                            }
                        }
                    });
                },
                
                exportCSV() {
                    this.isLoading = true;
                    this.loadingMessage = 'Generating CSV...';
                    
                    setTimeout(() => {
                        this.isLoading = false;
                        alert('CSV file has been generated and downloaded.');
                    }, 1500);
                }
            }));
        });
    </script>
<script>document.body.addEventListener('wheel', e => { if (!e.ctrlKey) return; e.preventDefault(); return }, { passive: false })</script>
	</body>
</html>